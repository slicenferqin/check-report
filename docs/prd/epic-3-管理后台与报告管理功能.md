# Epic 3: 管理后台与报告管理功能

**目标：** 开发管理员登录系统和后台管理界面，实现报告的上传、编辑、删除和列表查看功能，完成系统的闭环管理能力。

## Story 3.1: 管理员登录功能开发

**用户故事：**

作为一名**公司内部管理员**，
我想**通过用户名和密码登录管理后台**，
以便**安全地访问报告管理功能**。

**Acceptance Criteria:**

1. 实现管理员登录 API 接口 `POST /api/admin/login`，接收用户名和密码
2. 验证用户名和密码，密码使用 bcrypt 或类似算法进行哈希比对
3. 登录成功时，生成 JWT Token 并返回 200 状态码和 Token `{ "token": "...", "username": "..." }`
4. 登录失败时（用户名不存在或密码错误），返回 401 状态码和错误信息 `{ "error": "用户名或密码错误" }`
5. 实现前端登录页面（`/admin/login`），包含用户名、密码输入框和登录按钮
6. 前端提交登录请求后，显示 Loading 状态
7. 登录成功后，将 Token 存储到 localStorage 或 sessionStorage，并跳转到管理后台首页
8. 登录失败时，在登录页显示错误提示信息
9. 实现身份认证中间件（用于后续后台 API 接口），验证请求中的 JWT Token
10. Token 无效或过期时，返回 401 状态码，前端自动跳转到登录页
11. 编写单元测试，覆盖登录成功、密码错误、用户名不存在等场景
12. 测试登录功能的前后端集成，确保 Token 能够正确生成和验证

---

## Story 3.2: 管理后台首页与导航

**用户故事：**

作为一名**登录成功的管理员**，
我想**看到管理后台的首页和导航菜单**，
以便**快速访问不同的管理功能**。

**Acceptance Criteria:**

1. 实现管理后台布局（Layout），包含侧边栏导航和主内容区域
2. 侧边栏包含以下菜单项：
   - 报告列表
   - 上传报告
   - 退出登录
3. 点击菜单项时，切换到对应的页面或组件
4. 实现退出登录功能，点击后清除 Token 并跳转到登录页
5. 管理后台首页显示简单的欢迎信息和统计数据（如已上传报告总数）
6. 统计数据通过 API 接口 `GET /api/admin/stats` 获取（返回报告总数）
7. 未登录用户访问管理后台时，自动跳转到登录页
8. 页面采用响应式设计，支持平板和桌面端访问
9. 测试导航切换的流畅性和页面加载速度

---

## Story 3.3: 报告列表页开发

**用户故事：**

作为一名**管理员**，
我想**查看所有已上传的报告列表**，
以便**快速浏览和管理报告**。

**Acceptance Criteria:**

1. 实现报告列表 API 接口 `GET /api/admin/reports`，返回所有报告的列表（包含分页参数）
2. 接口必须包含身份认证中间件，验证 JWT Token
3. 接口支持分页查询（如 `?page=1&limit=20`），默认每页 20 条
4. 返回数据包括报告编号、报告类型、检测日期、设备名称、创建时间
5. 实现前端报告列表页（`/admin/reports`），使用表格组件展示报告列表
6. 表格包含以下列：报告编号、报告类型、检测日期、设备名称、操作
7. 操作列包含"查看"、"编辑"、"删除"按钮
8. 点击"查看"按钮，跳转到报告详情页（前台页面或后台详情页）
9. 实现分页控件，支持切换页码
10. 页面加载时显示 Loading 状态，数据加载完成后渲染表格
11. 列表为空时，显示"暂无报告"提示
12. 测试列表页在不同数据量下的加载速度和显示效果

---

## Story 3.4: 报告上传功能开发

**用户故事：**

作为一名**管理员**，
我想**上传新的报告扫描件并填写报告信息**，
以便**让客户能够查询到这份报告**。

**Acceptance Criteria:**

1. 实现报告上传页面（`/admin/upload`），包含表单和文件上传组件
2. 表单字段包括：
   - 报告编号（必填，文本输入）
   - 报告类型（必填，下拉选择：检测合格证、安装委托检验）
   - 检测日期（必填，日期选择器）
   - 设备名称（必填，文本输入）
   - 委托单位（必填，文本输入）
   - 使用单位（必填，文本输入）
   - 报告文件（必填，文件上传，支持 PDF、JPG、PNG，最大 10MB）
3. 文件上传组件支持拖拽上传和点击选择文件
4. 文件选择后，显示文件名和文件大小，允许用户重新选择
5. 提交表单时，先调用文件上传接口 `POST /api/admin/upload` 获取文件 URL
6. 文件上传成功后，再调用报告创建接口 `POST /api/admin/reports` 提交完整数据
7. 上传过程中，显示上传进度（如进度条）和"上传中"状态
8. 上传成功后，显示成功提示并清空表单，允许继续上传
9. 上传失败时，显示具体的错误信息（如"文件类型不支持"、"报告编号已存在"）
10. 实现表单验证，必填字段不能为空，文件必须选择
11. 测试上传不同类型和大小的文件，验证上传功能的稳定性
12. 测试报告编号重复的情况，确保错误提示清晰

---

## Story 3.5: 报告编辑功能开发

**用户故事：**

作为一名**管理员**，
我想**编辑已上传报告的元数据信息**，
以便**纠正错误或更新报告信息**。

**Acceptance Criteria:**

1. 实现报告编辑 API 接口 `PUT /api/admin/reports/:id`，接收报告 ID 和更新的字段
2. 接口必须包含身份认证中间件，验证 JWT Token
3. 接口支持更新以下字段：`report_type`、`inspection_date`、`equipment_name`、`client_company`、`user_company`
4. 报告编号（`report_number`）不允许修改
5. 文件 URL（`file_url`）不允许通过此接口修改（如需更换文件，应删除后重新上传）
6. 更新成功时，返回 200 状态码和更新后的报告 JSON
7. 报告 ID 不存在时，返回 404 状态码和错误信息
8. 实现前端报告编辑页面（`/admin/reports/:id/edit`），预填充现有报告数据
9. 编辑页面表单与上传页面类似，但不包含报告编号和文件上传（显示为只读或不可编辑）
10. 提交编辑后，显示成功提示并跳转回报告列表页
11. 编辑失败时，显示错误提示信息
12. 测试编辑功能，验证数据更新是否正确反映在列表和详情页

---

## Story 3.6: 报告删除功能开发

**用户故事：**

作为一名**管理员**，
我想**删除错误上传或过期的报告**，
以便**保持报告列表的准确性**。

**Acceptance Criteria:**

1. 实现报告删除 API 接口 `DELETE /api/admin/reports/:id`，根据报告 ID 删除报告
2. 接口必须包含身份认证中间件，验证 JWT Token
3. 删除操作必须同时删除数据库记录和 OSS 中的文件
4. 删除成功时，返回 200 状态码和成功信息 `{ "message": "报告删除成功" }`
5. 报告 ID 不存在时，返回 404 状态码和错误信息
6. 文件删除失败时，记录日志但不阻止数据库记录删除（避免数据不一致）
7. 在报告列表页的"删除"按钮上实现删除功能
8. 点击删除按钮时，弹出确认对话框："确定要删除该报告吗？删除后无法恢复"
9. 用户确认后，发起删除请求，显示 Loading 状态
10. 删除成功后，刷新报告列表，移除已删除的报告
11. 删除失败时，显示错误提示信息
12. 编写单元测试，覆盖删除成功、报告不存在等场景
13. 测试删除功能，验证报告在前台查询页无法再被查询到

---
